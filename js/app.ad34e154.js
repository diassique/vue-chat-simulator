(function(){"use strict";var e={8903:function(e,t,s){var r=s(5471),a=s(8505),n=function(){var e=this,t=e._self._c;return t(a.A,[t("router-view")],1)},i=[],o={name:"App"},c=o,u=s(1656),l=(0,u.A)(c,n,i,!1,null,null,null),m=l.exports,h=s(5453);r.Ay.use(h.A);var d=new h.A({}),g=s(173),p=s(6521),f=s(1689),v=s(8834),U=s(1526),S=s(5474),A=s(1075),_=s(4903),w=s(4350),y=s(8412),C=s(2112),E=s(7365),M=s(1735),b=function(){var e=this,t=e._self._c;return t(S.A,{staticClass:"fill-height",attrs:{fluid:""}},[t(y.A,{attrs:{align:"center",justify:"center"}},[t(U.A,{attrs:{cols:"12",sm:"8",md:"4"}},[t(f.A,{staticClass:"elevation-12"},[t(E.A,{attrs:{color:"primary",dark:""}},[t(M.sw,[e._v("Вход в систему")])],1),t(v.OQ,[t(C.A,{attrs:{items:e.users,"item-text":"name","item-value":"id",label:"Выберите пользователя","return-object":"","prepend-icon":"mdi-account-circle mdi-36px","menu-props":{maxHeight:"400"}},scopedSlots:e._u([{key:"item",fn:function({item:s,on:r}){return[t(A.A,{attrs:{value:s},on:{click:r.click}},[t(_.A,{staticClass:"mr-3"},[t("img",{staticClass:"avatar-image",attrs:{src:e.getAvatarPath(s.avatar)}})]),t(w.pr,[t(w.UZ,[e._v(e._s(s.name))])],1)],1)]}}]),model:{value:e.selectedUser,callback:function(t){e.selectedUser=t},expression:"selectedUser"}})],1),t(v.SL,[t(p.A,{attrs:{color:"primary",block:""},on:{click:e.login}},[e._v("Войти")])],1)],1)],1)],1)],1)},T=[],$=(s(4114),{name:"LoginView",data(){return{selectedUser:null,users:[]}},created(){this.fetchUsers()},methods:{getAvatarPath(e){const t=e.replace("@/assets/images/","");return`/vue-chat-simulator/assets/images/${t}`},async fetchUsers(){await this.$store.dispatch("user/fetchUsers"),this.users=this.$store.state.user.users},async login(){this.selectedUser&&this.selectedUser.id&&(await this.$store.dispatch("user/setCurrentUser",this.selectedUser),await this.$store.dispatch("chat/loadMessages"),this.$router.push({name:"chat"}).catch((e=>console.error(e))))}}}),x=$,k=(0,u.A)(x,b,T,!1,null,"356f3568",null),R=k.exports,I=s(9456),j=function(){var e=this,t=e._self._c;return t(S.A,{staticClass:"chat-container",attrs:{fluid:""}},[t(y.A,{attrs:{justify:"center"}},[t(U.A,{staticClass:"chat-card",attrs:{cols:"12",md:"10",lg:"8"}},[t(y.A,{staticClass:"chat-layout"},[t(U.A,{staticClass:"user-list",attrs:{cols:"4"}},[e.currentUser?t("div",{staticClass:"greeting"},[t(I.A,{staticClass:"mr-2"},[e._v("mdi-account")]),e._v(" Привет, "+e._s(e.currentUser.name)+"! ")],1):e._e(),t("UserList",{attrs:{users:e.users}}),t(p.A,{staticClass:"mt-3 logout-button",attrs:{color:"red",outlined:"",block:""},on:{click:e.logout}},[t(I.A,{attrs:{left:""}},[e._v("mdi-logout")]),e._v(" Выход ")],1)],1),t(U.A,{staticClass:"chat-window",attrs:{cols:"8"}},[t("ChatWindow")],1)],1)],1)],1)],1)},O=[],N=s(1770),H=s(2987),P=s(2006),D=function(){var e=this,t=e._self._c;return t(H.A,{staticClass:"overflow-y-auto",staticStyle:{"max-height":"500px"},attrs:{dense:"",subheader:""}},[t(P.A,[e._v("Пользователи")]),e._l(e.filteredUsers,(function(s){return[t(A.A,{key:s.id,class:{"active-user":s.id===e.currentChatUser},on:{click:function(t){return e.selectUser(s)}}},[t(_.A,{attrs:{color:"grey lighten-1"}},[t("img",{attrs:{src:e.getAvatarPath(s.avatar)}})]),t(w.pr,[t(w.UZ,{class:{"white--text":s.id===e.currentChatUser},domProps:{textContent:e._s(s.name)}})],1)],1),t(N.A,{key:`divider-${s.id}`})]}))],2)},L=[],G=s(5353),B={name:"UserList",props:{users:Array},computed:{...(0,G.aH)("user",["currentUser"]),...(0,G.aH)("chat",["currentChatUser"]),filteredUsers(){return this.users.filter((e=>e.id!==this.currentUser?.id))}},methods:{selectUser(e){this.$store.dispatch("chat/setCurrentChatUser",e.id)},getAvatarPath(e){const t=e.replace("@/assets/images/","");return`/vue-chat-simulator/assets/images/${t}`}}},W=B,z=(0,u.A)(W,D,L,!1,null,"44799f6e",null),Z=z.exports,K=s(9940),q=function(){var e=this,t=e._self._c;return t(S.A,[t(y.A,[t(U.A,[t(f.A,{staticClass:"pa-2",staticStyle:{"overflow-y":"auto"},attrs:{height:"500px"}},[t("MessageList",{attrs:{messages:e.currentConversationMessages,currentUser:e.currentUser,currentChatUser:e.currentChatUser}})],1),t(K.A,{staticClass:"mt-2",attrs:{"append-icon":"mdi-send",label:"Напишите сообщение...",outlined:""},on:{"click:append":e.send},model:{value:e.newMessage,callback:function(t){e.newMessage=t},expression:"newMessage"}})],1)],1)],1)},F=[],J=function(){var e=this,t=e._self._c;return t(H.A,{attrs:{dense:""}},e._l(e.messages,(function(s){return t("message-item",{key:s.id,attrs:{message:s,currentUser:e.currentUser,currentChatUser:e.currentChatUser}})})),1)},V=[],Q=function(){var e=this,t=e._self._c;return t("div",{class:"message "+(e.isSentByMe?"message-me":"message-them")},[t(A.A,[t(w.pr,[t(w.UZ,{staticClass:"message-text"},[e._v(e._s(e.message.text))]),t(w.w,[e._v(e._s(e.formattedTime))])],1)],1)],1)},Y=[],X={name:"MessageItem",props:{message:Object,currentUser:Object,currentChatUser:Number},computed:{formattedTime(){const e=new Date(this.message.timestamp),t=e.getFullYear(),s=(e.getMonth()+1).toString().padStart(2,"0"),r=e.getDate().toString().padStart(2,"0"),a=e.getHours().toString().padStart(2,"0"),n=e.getMinutes().toString().padStart(2,"0");return`${t}-${s}-${r} ${a}:${n}`},isSentByMe(){return this.message.senderId===this.currentUser.id}}},ee=X,te=(0,u.A)(ee,Q,Y,!1,null,"3753a2fe",null),se=te.exports,re={components:{MessageItem:se},props:{messages:Array},computed:{...(0,G.aH)("user",["currentUser"]),...(0,G.aH)("chat",["currentChatUser"])},watch:{messages(){this.$nextTick((()=>{this.scrollToBottom()}))}},mounted(){this.scrollToBottom()},methods:{scrollToBottom(){this.$el.scrollTop=this.$el.scrollHeight}}},ae=re,ne=(0,u.A)(ae,J,V,!1,null,null,null),ie=ne.exports,oe={components:{MessageList:ie},data(){return{newMessage:""}},computed:{...(0,G.aH)("user",["currentUser"]),...(0,G.aH)("chat",["currentChatUser"]),...(0,G.L8)("chat",["currentConversationMessages"])},methods:{...(0,G.i0)("chat",["sendMessage","loadMessages"]),async send(){this.newMessage.trim()&&(await this.sendMessage({text:this.newMessage,receiverId:this.currentChatUser}),this.newMessage="")}}},ce=oe,ue=(0,u.A)(ce,q,F,!1,null,null,null),le=ue.exports,me={name:"ChatView",components:{UserList:Z,ChatWindow:le},computed:{...(0,G.aH)("user",["users","currentUser"])},methods:{...(0,G.i0)("user",["fetchUsers","logout"]),...(0,G.i0)("chat",["loadMessages"]),async initData(){await this.fetchUsers(),await this.loadMessages()},logout(){this.$store.dispatch("user/logout"),this.$router.push({name:"login"})}},async created(){await this.$store.dispatch("user/loadCurrentUser"),this.currentUser?await this.initData():this.$router.push({name:"login"})}},he=me,de=(0,u.A)(he,j,O,!1,null,"71c6871e",null),ge=de.exports,pe=s(3790),fe=s.n(pe);const ve={users:[],currentUser:null},Ue={SET_USERS(e,t){e.users=t},SET_CURRENT_USER(e,t){e.currentUser=t}},Se={async fetchUsers({commit:e}){try{const t=await fe().getItem("users");if(t)e("SET_USERS",t);else{const t=[{id:1,name:"Aibar Muratov",avatar:"1.jpg"},{id:2,name:"Nurlan Kazybekov",avatar:"2.jpg"},{id:3,name:"Alexander Orlov",avatar:"3.jpg"},{id:4,name:"Katerine Pavlova",avatar:"4.jpg"},{id:5,name:"Aizhan Zhunusova",avatar:"5.jpg"},{id:6,name:"Bauyrzhan Bekmukhanbetov",avatar:"6.jpg"},{id:7,name:"Gulnaz Sadykova",avatar:"7.jpg"}];await fe().setItem("users",t),e("SET_USERS",t)}}catch(t){console.error("Ошибка при загрузке пользователей:",t)}},async addUser({commit:e,state:t},s){const r=[...t.users,s];await fe().setItem("users",r),e("SET_USERS",r)},loadCurrentUser({commit:e}){return new Promise((t=>{const s=JSON.parse(sessionStorage.getItem("currentUser"));s&&e("SET_CURRENT_USER",s),t()}))},setCurrentUser({commit:e},t){e("SET_CURRENT_USER",t),sessionStorage.setItem("currentUser",JSON.stringify(t))},logout({commit:e}){e("SET_CURRENT_USER",null),sessionStorage.removeItem("currentUser")}},Ae={currentUser:e=>e.currentUser};var _e={namespaced:!0,state:ve,mutations:Ue,actions:Se,getters:Ae};const we={messages:{},currentChatUser:null,newMessage:null},ye={SET_CURRENT_CHAT_USER(e,t){e.currentChatUser=t},SET_MESSAGES(e,t){e.messages=t},SET_NEW_MESSAGE(e,t){e.newMessage=t},CLEAR_NEW_MESSAGE(e){e.newMessage=null},ADD_MESSAGES(e,{conversationKey:t,messages:s}){e.messages[t].push(...s)}},Ce={setCurrentChatUser({commit:e},t){e("SET_CURRENT_CHAT_USER",t)},async sendMessage({commit:e,dispatch:t,rootState:s},{text:r,receiverId:a}){const n=s.user.currentUser.id,i=(new Date).toISOString(),o={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,senderId:n,receiverId:a,text:r,timestamp:i};e("SET_NEW_MESSAGE",o),t("saveMessage",{message:o,senderId:n,receiverId:a}),e("CLEAR_NEW_MESSAGE")},saveMessage({state:e},{message:t,senderId:s,receiverId:r}){const a=`${s}-${r}`,n=`${r}-${s}`;e.messages[a]||(e.messages[a]=[]),e.messages[n]||(e.messages[n]=[]),e.messages[a].push(t),e.messages[n].push(t),fe().setItem("messages",e.messages)},async loadMessages({commit:e}){try{const t=await fe().getItem("messages")||{};e("SET_MESSAGES",t)}catch(t){console.error("Error loading messages:",t)}}},Ee={currentConversationMessages:(e,t,s)=>{const r=s.user.currentUser,a=e.currentChatUser;if(!r||!a)return[];const n=`${r.id}-${a}`,i=`${a}-${r.id}`;let o=[...e.messages[n]||[],...e.messages[i]||[]];o=o.sort(((e,t)=>new Date(e.timestamp)-new Date(t.timestamp)));const c=new Map;return o=o.filter((e=>!c.has(e.id)&&c.set(e.id,!0))),e.newMessage&&e.newMessage.senderId===r.id&&e.newMessage.receiverId===a&&(c.has(e.newMessage.id)||o.push(e.newMessage)),o}};var Me={namespaced:!0,state:we,mutations:ye,actions:Ce,getters:Ee};r.Ay.use(G.Ay);var be=new G.Ay.Store({modules:{user:_e,chat:Me}});r.Ay.use(g.Ay);const Te=[{path:"/",redirect:"/login"},{path:"/login",name:"login",component:R},{path:"/chat",name:"chat",component:ge,meta:{requiresAuth:!0}}],$e=new g.Ay({mode:"history",base:"/vue-chat-simulator/",routes:Te});$e.beforeEach(((e,t,s)=>{const r=be.state.user.currentUser,a=e.matched.some((e=>e.meta.requiresAuth));a&&!r?s("/login"):!a&&r?s("/chat"):s()}));var xe=$e;async function ke(){await be.dispatch("user/loadCurrentUser"),new r.Ay({router:xe,store:be,vuetify:d,render:e=>e(m)}).$mount("#app")}r.Ay.config.productionTip=!1,ke()}},t={};function s(r){var a=t[r];if(void 0!==a)return a.exports;var n=t[r]={exports:{}};return e[r].call(n.exports,n,n.exports,s),n.exports}s.m=e,function(){var e=[];s.O=function(t,r,a,n){if(!r){var i=1/0;for(l=0;l<e.length;l++){r=e[l][0],a=e[l][1],n=e[l][2];for(var o=!0,c=0;c<r.length;c++)(!1&n||i>=n)&&Object.keys(s.O).every((function(e){return s.O[e](r[c])}))?r.splice(c--,1):(o=!1,n<i&&(i=n));if(o){e.splice(l--,1);var u=a();void 0!==u&&(t=u)}}return t}n=n||0;for(var l=e.length;l>0&&e[l-1][2]>n;l--)e[l]=e[l-1];e[l]=[r,a,n]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,r){var a,n,i=r[0],o=r[1],c=r[2],u=0;if(i.some((function(t){return 0!==e[t]}))){for(a in o)s.o(o,a)&&(s.m[a]=o[a]);if(c)var l=c(s)}for(t&&t(r);u<i.length;u++)n=i[u],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(l)},r=self["webpackChunkvue_chat_simulator"]=self["webpackChunkvue_chat_simulator"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=s.O(void 0,[504],(function(){return s(8903)}));r=s.O(r)})();
//# sourceMappingURL=app.ad34e154.js.map